<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server_model.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: server_model.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const ConnectorGamaServer = require('./gama_server.js');
const MonitorServer = require('./monitor_server.js');
const PlayerServer = require('./player_server.js');
const App = require('./app.js');
const fs = require('fs');

/**
 * Creates the model of the project
 */
class ServerModel {
    /**
     * Instanciates all the components of the server
     */
    constructor() {
        this.json_state = JSON.parse(fs.readFileSync('src/json_state.json', 'utf-8'));
        this.json_settings = JSON.parse(fs.readFileSync('settings.json', 'utf-8'));
        this.json_simulation = {};
        this.monitor_server = new MonitorServer(this);
        this.player_server = new PlayerServer(this);
        this.app = new App(this);
        this.gama_connector = new ConnectorGamaServer(this);
    }

    /**
     * Restarts all the components whcih needs to be restarted
     */
    restart(){
        this.player_server.close()
        this.gama_connector.close()
        this.monitor_server.close()
        this.player_server = new PlayerServer(this);
        this.gama_connector = new ConnectorGamaServer(this);
        this.monitor_server = new MonitorServer(this);
    }

    /**
     * Changes the json_settings
     * @param {JSON} json_settings - The new json
     */
    changeJsonSettings(json_settings){
        this.json_settings = json_settings
        fs.writeFileSync('settings.json', JSON.stringify(json_settings,null, 2), 'utf-8')
        this.restart()
    }

    /**
     * Sends the json_settings to the monitor
     */
    sendJsonSettings() {
        this.monitor_server.sendMonitorJsonSettings();
    }

    /**
     * Sends to both the monitor and the players the json_state
     */
    notifyMonitor() {
        this.monitor_server.sendMonitorJsonState();
        this.player_server.broadcastJsonStatePlayer();
    }

    /**
     * Sends to both the monitor and the players the json_simulation
     */
    notifyPlayerClients() {
        this.player_server.broadcastSimulationPlayer()
        this.monitor_server.sendMonitorJsonSimulation()
    }

    /**
     * Removes every players wich are authenticated
     */
    removeEveryPlayers() {
        this.gama_connector.removeEveryPlayers();
    }

    /**
     * Add every connected but not authenticated players to the simulation
     */
    addEveryPlayers() {
        this.gama_connector.addEveryPlayers();
    }

    /**
     * Adds a new player to the simulation
     * @param {String} id_player - The id of the player
     */
    addPlayer(id_player) {
        this.gama_connector.addPlayer(id_player);
    }

    /**
     * Removes a new player to the simulation
     * @param {String} id_player - The id of the player
     */
    removePlayer(id_player) {
        this.gama_connector.removePlayer(id_player);
    }

    /**
     * Sends an expression for a certain player
     * @param {String} id_player - The id of the player to apply this expression
     * @param {String} expr - The expression. If this expression contains $id, it will be replaced by the id of the player wich asked the method
     * @returns 
     */
    sendExpression(id_player, expr) {
        this.gama_connector.sendExpression(id_player,expr);
    }

    /**
     * Cf GamaConnector
     */
    launchExperiment() {
        this.gama_connector.launchExperiment();
    }

    /**
     * Cf GamaConnector
     */
    stopExperiment() {
        this.gama_connector.stopExperiment();
    }

    /**
     * Cf GamaConnector
     */
    pauseExperiment() {
        this.gama_connector.pauseExperiment();
    }

    /**
     * Cf GamaConnector
     */
    resumeExperiment() {
        this.gama_connector.resumeExperiment();
    }

    /**
     * Cf GamaConnector
     */
    connectGama() {
        this.gama_connector.connectGama();
    }

}

module.exports = ServerModel;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="App.html">App</a></li><li><a href="ConnectorGamaServer.html">ConnectorGamaServer</a></li><li><a href="MonitorServer.html">MonitorServer</a></li><li><a href="PlayerServer.html">PlayerServer</a></li><li><a href="ServerModel.html">ServerModel</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Wed Nov 08 2023 16:02:25 GMT+0700 (GMT+07:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
